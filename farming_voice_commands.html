<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌾 Agriculture Voice Commands - Testing Suite</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            text-align: center;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .voice-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        .voice-btn {
            background-color: #FF6B6B;
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .voice-btn:hover {
            background-color: #FF5252;
            transform: scale(1.05);
        }
        .voice-btn.listening {
            background-color: #4CAF50;
            animation: pulse 1.5s infinite;
        }
        .voice-btn.speaking {
            background-color: #2196F3;
            animation: pulse 1.5s infinite;
        }
        .voice-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .voice-status {
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin: 10px 0;
        }
        .voice-status.listening {
            background-color: #E8F5E8;
            color: #4CAF50;
        }
        .voice-status.processing {
            background-color: #E3F2FD;
            color: #2196F3;
        }
        .voice-status.error {
            background-color: #FFEBEE;
            color: #F44336;
        }
        .farming-scenarios {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .scenario-card {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
            position: relative;
        }
        .scenario-card h4 {
            margin-top: 0;
            color: #2d5a2d;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .voice-sample {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 3px solid #4CAF50;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .voice-sample:hover {
            background: #e8f5e8;
            transform: translateX(5px);
        }
        .voice-sample .language {
            font-weight: bold;
            color: #4CAF50;
            font-size: 12px;
            margin-bottom: 5px;
        }
        .voice-sample .text {
            font-size: 16px;
            line-height: 1.4;
        }
        .voice-sample .meaning {
            font-size: 12px;
            color: #666;
            font-style: italic;
            margin-top: 5px;
        }
        .test-section {
            background: #e8f4fd;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .input-group {
            margin: 15px 0;
        }
        .input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }
        .input-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
            min-height: 80px;
        }
        .language-selector {
            margin: 15px 0;
        }
        .language-selector select {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background-color: white;
            font-size: 14px;
            min-width: 150px;
        }
        .response-area {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            min-height: 100px;
        }
        .response-content {
            white-space: pre-wrap;
            line-height: 1.6;
            font-size: 16px;
        }
        .submit-btn {
            background-color: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }
        .submit-btn:hover {
            background-color: #45a049;
        }
        .tips-section {
            background: #fff3e0;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #FF9800;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🌾 Agriculture Voice Commands - Testing Suite</h1>
        <p>Comprehensive Voice Testing for Farming Scenarios</p>
        <p><strong>🎤 Click Samples • 🗣️ Test Voice • 👂 Hear Responses</strong></p>
    </div>
    
    <div class="container">
        <div class="tips-section">
            <h3>💡 Voice Testing Tips</h3>
            <ul>
                <li>🎯 <strong>Click any voice sample below</strong> to automatically fill the text area</li>
                <li>🎤 <strong>Use voice input</strong> by clicking "Start Voice" and speaking clearly</li>
                <li>🌐 <strong>Switch languages</strong> using the dropdown for better recognition</li>
                <li>🔊 <strong>Test speech output</strong> by clicking "Speak Answer" after getting responses</li>
                <li>📱 <strong>Works best on Chrome/Edge</strong> with microphone permissions enabled</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>🎙️ Voice Input Testing</h3>
            <div class="input-group">
                <label for="query">Your Agriculture Query (Type or Use Voice):</label>
                <textarea id="query" name="query" placeholder="Ask about weather, crops, prices, pests, irrigation, or government schemes..."></textarea>
                
                <div class="voice-controls">
                    <button type="button" id="voiceBtn" class="voice-btn" onclick="toggleVoiceRecognition()">
                        🎤 <span id="voiceBtnText">Start Voice</span>
                    </button>
                    <button type="button" id="clearBtn" class="voice-btn" onclick="clearQuery()" style="background-color: #9E9E9E;">
                        🗑️ <span>Clear</span>
                    </button>
                    <button type="button" id="speakBtn" class="voice-btn" onclick="speakResponse()" style="display: none;">
                        🔊 <span>Speak Answer</span>
                    </button>
                </div>
                
                <div class="language-selector">
                    <label for="voiceLang">Voice Language:</label>
                    <select id="voiceLang" onchange="updateVoiceLanguage()">
                        <option value="en-US">🇺🇸 English (US)</option>
                        <option value="hi-IN">🇮🇳 हिन्दी (Hindi)</option>
                        <option value="mr-IN">🇮🇳 मराठी (Marathi)</option>
                        <option value="bn-IN">🇮🇳 বাংলা (Bengali)</option>
                        <option value="te-IN">🇮🇳 తెలుగు (Telugu)</option>
                        <option value="ta-IN">🇮🇳 தமிழ் (Tamil)</option>
                        <option value="gu-IN">🇮🇳 ગુજરાતી (Gujarati)</option>
                        <option value="kn-IN">🇮🇳 ಕನ್ನಡ (Kannada)</option>
                    </select>
                </div>
                
                <div id="voiceStatus" class="voice-status" style="display: none;"></div>
            </div>
            
            <button type="button" class="submit-btn" onclick="submitQuery()">🚀 Get AI Advice</button>
            
            <div id="response" class="response-area" style="display: none;">
                <div id="responseContent"></div>
            </div>
        </div>
    </div>
    
    <div class="container">
        <h2>🎯 Farming Voice Command Samples</h2>
        <p>Click any sample to test it immediately, or use them as reference for voice input:</p>
        
        <div class="farming-scenarios">
            <div class="scenario-card">
                <h4>🌤️ Weather & Climate</h4>
                <div class="voice-sample" onclick="setQuery('What is the weather forecast for the next 3 days?')">
                    <div class="language">ENGLISH</div>
                    <div class="text">"What is the weather forecast for the next 3 days?"</div>
                </div>
                <div class="voice-sample" onclick="setQuery('आज बारिश होगी क्या?')">
                    <div class="language">हिन्दी</div>
                    <div class="text">"आज बारिश होगी क्या?"</div>
                    <div class="meaning">Will it rain today?</div>
                </div>
                <div class="voice-sample" onclick="setQuery('कल तेज हवा चलेगी क्या?')">
                    <div class="language">हिन्दी</div>
                    <div class="text">"कल तेज हवा चलेगी क्या?"</div>
                    <div class="meaning">Will there be strong winds tomorrow?</div>
                </div>
                <div class="voice-sample" onclick="setQuery('Temperature will be high this week?')">
                    <div class="language">ENGLISH</div>
                    <div class="text">"Temperature will be high this week?"</div>
                </div>
            </div>
            
            <div class="scenario-card">
                <h4>🌾 Crop Management</h4>
                <div class="voice-sample" onclick="setQuery('धान की फसल कब बोएं?')">
                    <div class="language">हिन्दी</div>
                    <div class="text">"धान की फसल कब बोएं?"</div>
                    <div class="meaning">When should I sow rice crop?</div>
                </div>
                <div class="voice-sample" onclick="setQuery('Which crop is best for kharif season?')">
                    <div class="language">ENGLISH</div>
                    <div class="text">"Which crop is best for kharif season?"</div>
                </div>
                <div class="voice-sample" onclick="setQuery('गेहूं की फसल में पीली पत्तियां क्यों हैं?')">
                    <div class="language">हिन्दी</div>
                    <div class="text">"गेहूं की फसल में पीली पत्तियां क्यों हैं?"</div>
                    <div class="meaning">Why are wheat crop leaves turning yellow?</div>
                </div>
                <div class="voice-sample" onclick="setQuery('Cotton cultivation guide for beginners')">
                    <div class="language">ENGLISH</div>
                    <div class="text">"Cotton cultivation guide for beginners"</div>
                </div>
            </div>
            
            <div class="scenario-card">
                <h4>🐛 Pest & Disease Control</h4>
                <div class="voice-sample" onclick="setQuery('मेरे टमाटर के पौधे में कीट लगे हैं')">
                    <div class="language">हिन्दी</div>
                    <div class="text">"मेरे टमाटर के पौधे में कीट लगे हैं"</div>
                    <div class="meaning">My tomato plants have pests</div>
                </div>
                <div class="voice-sample" onclick="setQuery('How to control aphids in vegetables organically?')">
                    <div class="language">ENGLISH</div>
                    <div class="text">"How to control aphids in vegetables organically?"</div>
                </div>
                <div class="voice-sample" onclick="setQuery('आलू में झुलसा रोग का इलाज क्या है?')">
                    <div class="language">हिन्दी</div>
                    <div class="text">"आलू में झुलसा रोग का इलाज क्या है?"</div>
                    <div class="meaning">What is the treatment for potato blight disease?</div>
                </div>
                <div class="voice-sample" onclick="setQuery('Natural pesticide for fruit flies')">
                    <div class="language">ENGLISH</div>
                    <div class="text">"Natural pesticide for fruit flies"</div>
                </div>
            </div>
            
            <div class="scenario-card">
                <h4>💰 Market Prices</h4>
                <div class="voice-sample" onclick="setQuery('गेहूं का आज का भाव क्या है?')">
                    <div class="language">हिन्दी</div>
                    <div class="text">"गेहूं का आज का भाव क्या है?"</div>
                    <div class="meaning">What is today's wheat price?</div>
                </div>
                <div class="voice-sample" onclick="setQuery('Cotton market rate in Gujarat today')">
                    <div class="language">ENGLISH</div>
                    <div class="text">"Cotton market rate in Gujarat today"</div>
                </div>
                <div class="voice-sample" onclick="setQuery('प्याज की कीमत कब बढ़ेगी?')">
                    <div class="language">हिन्दी</div>
                    <div class="text">"प्याज की कीमत कब बढ़ेगी?"</div>
                    <div class="meaning">When will onion prices increase?</div>
                </div>
                <div class="voice-sample" onclick="setQuery('MSP rate for paddy this season')">
                    <div class="language">ENGLISH</div>
                    <div class="text">"MSP rate for paddy this season"</div>
                </div>
            </div>
            
            <div class="scenario-card">
                <h4>💧 Irrigation & Water</h4>
                <div class="voice-sample" onclick="setQuery('कपास की फसल में पानी कब देना चाहिए?')">
                    <div class="language">हिन्दी</div>
                    <div class="text">"कपास की फसल में पानी कब देना चाहिए?"</div>
                    <div class="meaning">When should I water cotton crop?</div>
                </div>
                <div class="voice-sample" onclick="setQuery('Drip irrigation system cost and benefits')">
                    <div class="language">ENGLISH</div>
                    <div class="text">"Drip irrigation system cost and benefits"</div>
                </div>
                <div class="voice-sample" onclick="setQuery('बारिश के बाद खेत में पानी भरा है, क्या करें?')">
                    <div class="language">हिन्दी</div>
                    <div class="text">"बारिश के बाद खेत में पानी भरा है, क्या करें?"</div>
                    <div class="meaning">Field is waterlogged after rain, what to do?</div>
                </div>
                <div class="voice-sample" onclick="setQuery('Water saving techniques for farming')">
                    <div class="language">ENGLISH</div>
                    <div class="text">"Water saving techniques for farming"</div>
                </div>
            </div>
            
            <div class="scenario-card">
                <h4>🏛️ Government Schemes</h4>
                <div class="voice-sample" onclick="setQuery('PM Kisan योजना के लिए कैसे अप्लाई करें?')">
                    <div class="language">हिन्दी</div>
                    <div class="text">"PM Kisan योजना के लिए कैसे अप्लाई करें?"</div>
                    <div class="meaning">How to apply for PM Kisan scheme?</div>
                </div>
                <div class="voice-sample" onclick="setQuery('Crop insurance claim process step by step')">
                    <div class="language">ENGLISH</div>
                    <div class="text">"Crop insurance claim process step by step"</div>
                </div>
                <div class="voice-sample" onclick="setQuery('किसान क्रेडिट कार्ड कैसे बनवाएं?')">
                    <div class="language">हिन्दी</div>
                    <div class="text">"किसान क्रेडिट कार्ड कैसे बनवाएं?"</div>
                    <div class="meaning">How to get Kisan Credit Card?</div>
                </div>
                <div class="voice-sample" onclick="setQuery('Subsidy for organic farming certification')">
                    <div class="language">ENGLISH</div>
                    <div class="text">"Subsidy for organic farming certification"</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Voice Recognition Variables
        let recognition;
        let isListening = false;
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;
        let lastResponse = '';
        let currentVoiceLang = 'en-US';

        // Initialize Speech Recognition
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
            } else if ('SpeechRecognition' in window) {
                recognition = new SpeechRecognition();
            } else {
                console.log('Speech recognition not supported');
                document.getElementById('voiceBtn').style.display = 'none';
                return false;
            }
            
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = currentVoiceLang;
            
            recognition.onstart = function() {
                isListening = true;
                updateVoiceButton('listening');
                showVoiceStatus('🎤 Listening... Speak clearly!', 'listening');
            };
            
            recognition.onresult = function(event) {
                let finalTranscript = '';
                let interimTranscript = '';
                
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                if (finalTranscript) {
                    document.getElementById('query').value = finalTranscript;
                    showVoiceStatus('✅ Voice captured successfully!', 'processing');
                    setTimeout(() => hideVoiceStatus(), 3000);
                } else if (interimTranscript) {
                    document.getElementById('query').value = interimTranscript;
                    showVoiceStatus('🎙️ Processing speech...', 'processing');
                }
            };
            
            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
                let errorMsg = 'Voice recognition error';
                switch(event.error) {
                    case 'no-speech':
                        errorMsg = '❌ No speech detected. Please try again.';
                        break;
                    case 'network':
                        errorMsg = '❌ Network error. Check internet connection.';
                        break;
                    case 'not-allowed':
                        errorMsg = '❌ Microphone access denied. Please enable microphone.';
                        break;
                    case 'audio-capture':
                        errorMsg = '❌ No microphone found. Please connect microphone.';
                        break;
                }
                showVoiceStatus(errorMsg, 'error');
                isListening = false;
                updateVoiceButton('idle');
                setTimeout(() => hideVoiceStatus(), 5000);
            };
            
            recognition.onend = function() {
                isListening = false;
                updateVoiceButton('idle');
            };
            
            return true;
        }
        
        // Toggle Voice Recognition
        function toggleVoiceRecognition() {
            if (!recognition) {
                if (!initSpeechRecognition()) {
                    alert('❌ Speech recognition is not supported in this browser.\n\nPlease use:\n✅ Google Chrome (recommended)\n✅ Microsoft Edge\n✅ Safari\n\nMake sure to allow microphone access when prompted.');
                    return;
                }
            }
            
            if (isListening) {
                recognition.stop();
                isListening = false;
                updateVoiceButton('idle');
                hideVoiceStatus();
            } else {
                recognition.lang = currentVoiceLang;
                recognition.start();
            }
        }
        
        // Update Voice Button State
        function updateVoiceButton(state) {
            const btn = document.getElementById('voiceBtn');
            const btnText = document.getElementById('voiceBtnText');
            
            btn.className = 'voice-btn';
            
            switch(state) {
                case 'listening':
                    btn.classList.add('listening');
                    btnText.textContent = 'Stop Voice';
                    break;
                case 'processing':
                    btn.disabled = true;
                    btnText.textContent = 'Processing...';
                    break;
                case 'idle':
                default:
                    btn.disabled = false;
                    btnText.textContent = 'Start Voice';
                    break;
            }
        }
        
        // Show Voice Status
        function showVoiceStatus(message, type) {
            const status = document.getElementById('voiceStatus');
            status.innerHTML = message;
            status.className = 'voice-status ' + type;
            status.style.display = 'block';
        }
        
        // Hide Voice Status
        function hideVoiceStatus() {
            document.getElementById('voiceStatus').style.display = 'none';
        }
        
        // Update Voice Language
        function updateVoiceLanguage() {
            currentVoiceLang = document.getElementById('voiceLang').value;
            if (recognition) {
                recognition.lang = currentVoiceLang;
            }
            console.log('Voice language updated to:', currentVoiceLang);
        }
        
        // Set Query from Sample
        function setQuery(queryText) {
            document.getElementById('query').value = queryText;
            
            // Auto-detect language and update voice language
            if (/[\u0900-\u097F]/.test(queryText)) {
                // Hindi detected
                document.getElementById('voiceLang').value = 'hi-IN';
                currentVoiceLang = 'hi-IN';
            } else {
                // English
                document.getElementById('voiceLang').value = 'en-US';
                currentVoiceLang = 'en-US';
            }
            
            // Scroll to query area
            document.getElementById('query').scrollIntoView({ behavior: 'smooth', block: 'center' });
            document.getElementById('query').focus();
        }
        
        // Clear Query
        function clearQuery() {
            document.getElementById('query').value = '';
            document.getElementById('response').style.display = 'none';
            document.getElementById('speakBtn').style.display = 'none';
            lastResponse = '';
        }
        
        // Submit Query (Enhanced with farming-specific responses)
        function submitQuery() {
            const query = document.getElementById('query').value.trim();
            
            if (!query) {
                alert('Please enter a query or use voice input first.');
                return;
            }
            
            const responseDiv = document.getElementById('response');
            const responseContent = document.getElementById('responseContent');
            
            // Show loading
            responseDiv.style.display = 'block';
            responseContent.innerHTML = '🤖 Analyzing your farming query...\n⏳ Please wait while I provide expert advice...';
            
            // Simulate AI response with farming-specific content
            setTimeout(() => {
                let response;
                let language = 'en';
                
                // Detect language
                if (/[\u0900-\u097F]/.test(query)) {
                    language = 'hi';
                }
                
                // Generate contextual farming response
                response = generateFarmingResponse(query, language);
                
                // Store for voice synthesis
                lastResponse = response;
                
                // Show speak button
                document.getElementById('speakBtn').style.display = 'flex';
                
                // Update voice language
                document.getElementById('voiceLang').value = language === 'hi' ? 'hi-IN' : 'en-US';
                currentVoiceLang = language === 'hi' ? 'hi-IN' : 'en-US';
                
                responseContent.innerHTML = `${response}\n\n---\n🎙️ Click "Speak Answer" to hear this response aloud\n📊 Language: ${language === 'hi' ? 'Hindi (हिन्दी)' : 'English'} | 🤖 AI Farming Assistant`;
                
            }, 2000);
        }
        
        // Generate Farming-Specific Response
        function generateFarmingResponse(query, language) {
            const lowerQuery = query.toLowerCase();
            
            if (language === 'hi') {
                if (lowerQuery.includes('बारिश') || lowerQuery.includes('मौसम')) {
                    return "मौसम की जानकारी के अनुसार, आगामी दिनों में बारिश की संभावना है। फसल की सुरक्षा के लिए जल निकासी की व्यवस्था करें। स्थानीय मौसम विभाग से नवीनतम जानकारी प्राप्त करें।";
                }
                if (lowerQuery.includes('कीट') || lowerQuery.includes('रोग')) {
                    return "फसल में कीट या रोग की समस्या के लिए तुरंत जैविक कीटनाशक का प्रयोग करें। नीम का तेल, गोमूत्र या त्रिकोडर्मा का उपयोग करें। गंभीर स्थिति में कृषि विशेषज्ञ से सलाह लें।";
                }
                if (lowerQuery.includes('धान') || lowerQuery.includes('चावल')) {
                    return "धान की फसल के लिए खरीफ सीजन उत्तम है। मानसून के साथ बुआई करें। पानी की उचित व्यवस्था रखें। उन्नत किस्म के बीज का चयन करें।";
                }
                if (lowerQuery.includes('कीमत') || lowerQuery.includes('भाव')) {
                    return "बाजार की कीमतों में उतार-चढ़ाव होता रहता है। MSP की जानकारी के लिए स्थानीय कृषि मंडी से संपर्क करें। सही समय पर बेचने के लिए भंडारण की व्यवस्था करें।";
                }
                return "आपके प्रश्न के लिए धन्यवाद। कृषि संबंधी सभी जानकारी के लिए स्थानीय कृषि विभाग से संपर्क करें। उन्नत खेती की तकनीक अपनाएं और बेहतर उत्पादन पाएं।";
            } else {
                if (lowerQuery.includes('weather') || lowerQuery.includes('rain')) {
                    return "Based on current weather patterns, plan your farming activities accordingly. Monitor rainfall forecasts and ensure proper drainage systems. Contact local meteorological department for accurate weather updates.";
                }
                if (lowerQuery.includes('pest') || lowerQuery.includes('disease')) {
                    return "For pest and disease management, use integrated pest management (IPM) techniques. Apply organic pesticides like neem oil, use beneficial insects, and maintain crop rotation. Consult agricultural experts for severe infestations.";
                }
                if (lowerQuery.includes('rice') || lowerQuery.includes('paddy')) {
                    return "Rice cultivation is best during kharif season with monsoon onset. Ensure proper field preparation, use certified seeds, maintain optimal water levels, and follow recommended fertilizer schedules for better yield.";
                }
                if (lowerQuery.includes('price') || lowerQuery.includes('market')) {
                    return "Market prices fluctuate based on demand-supply dynamics. Check current MSP rates, monitor local market trends, and consider proper storage facilities to get better prices during off-season marketing.";
                }
                return "Thank you for your agricultural query. For comprehensive farming guidance, consult local agricultural extension officers. Adopt modern farming techniques and sustainable practices for improved productivity and profitability.";
            }
        }
        
        // Speech Synthesis
        function speakResponse() {
            if (!lastResponse) {
                alert('No response to speak. Please submit a query first.');
                return;
            }
            
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
                updateSpeakButton('idle');
                return;
            }
            
            currentUtterance = new SpeechSynthesisUtterance(lastResponse);
            
            // Set voice based on language
            const voices = speechSynthesis.getVoices();
            const langCode = currentVoiceLang.substring(0, 2);
            const preferredVoice = voices.find(voice => voice.lang.startsWith(langCode));
            
            if (preferredVoice) {
                currentUtterance.voice = preferredVoice;
            }
            
            currentUtterance.rate = 0.8;
            currentUtterance.pitch = 1.0;
            currentUtterance.volume = 1.0;
            
            currentUtterance.onstart = () => updateSpeakButton('speaking');
            currentUtterance.onend = () => updateSpeakButton('idle');
            currentUtterance.onerror = () => updateSpeakButton('idle');
            
            speechSynthesis.speak(currentUtterance);
        }
        
        // Update Speak Button
        function updateSpeakButton(state) {
            const btn = document.getElementById('speakBtn');
            const span = btn.querySelector('span');
            
            btn.className = 'voice-btn';
            
            if (state === 'speaking') {
                btn.classList.add('speaking');
                span.textContent = 'Stop Speaking';
            } else {
                span.textContent = 'Speak Answer';
            }
        }
        
        // Initialize on page load
        window.addEventListener('load', function() {
            console.log('Farming Voice Commands - Testing Suite Loaded');
            
            // Load voices
            if (speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = () => console.log('Voices loaded:', speechSynthesis.getVoices().length);
            }
            
            // Check speech recognition support
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                document.getElementById('voiceBtn').innerHTML = '❌ <span>Voice Not Supported</span>';
                document.getElementById('voiceBtn').disabled = true;
                console.warn('Speech recognition not supported');
            }
            
            // Auto-focus on query field
            document.getElementById('query').focus();
        });
    </script>
</body>
</html>
